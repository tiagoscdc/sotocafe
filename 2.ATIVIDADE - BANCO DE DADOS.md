# ATIVIDADE - BANCO DE DADOS

## 1. Introdução

Este documento apresenta o Modelo Conceitual, o Modelo Entidade-Relacionamento (ER) e o Projeto Físico do banco de dados do sistema Soto Café, desenvolvidos a partir do Diagrama de Classes. O modelo conceitual descreve as entidades e relacionamentos em alto nível, o modelo ER representa graficamente a estrutura do banco, e o projeto físico detalha a implementação real no SGBD.

---

## 2. Modelo Conceitual

O Modelo Conceitual descreve as entidades do domínio do negócio, seus atributos principais e os relacionamentos entre elas, sem se preocupar com detalhes de implementação técnica.

### 2..1 Entidades Principais

#### Entidade: USUARIO

Representa todos os usuários do sistema, incluindo clientes, administradores e funcionários.

**Atributos Principais:**
- Identificador único (id_usuario)
- Nome completo
- E-mail (único no sistema)
- Senha (criptografada)
- Telefone
- CPF (opcional)
- Tipo de usuário (Cliente, Administrador, Gerente de Conteúdo, Expedição, Suporte, Barista)
- Status (Ativo, Inativo, Bloqueado)
- Data de cadastro
- Data do último acesso
- Flag de e-mail verificado

**Relacionamentos:**
- Possui vários ENDERECOS (1:N)
- Realiza vários PEDIDOS (1:N)
- Possui um PROGRAMA_FIDELIDADE (1:1)
- Possui um CARRINHO (1:1 ou 1:N)
- Pode criar LOTES_TORRA (1:N) - se for Barista
- Pode alterar STATUS_PEDIDO (1:N) - se for Administrador/Expedição

#### Entidade: ENDERECO

Representa endereços de entrega e cobrança dos usuários.

**Atributos Principais:**
- Identificador único (id_endereco)
- Referência ao USUARIO (FK)
- Tipo de endereço (Residencial, Comercial, Cobrança)
- CEP
- Rua/Logradouro
- Número
- Complemento (opcional)
- Bairro
- Cidade
- Estado (UF)
- Ponto de referência (opcional)
- Flag de endereço principal

**Relacionamentos:**
- Pertence a um USUARIO (N:1)
- Usado em vários PEDIDOS (1:N)

#### Entidade: CATEGORIA

Representa categorias e subcategorias de produtos.

**Atributos Principais:**
- Identificador único (id_categoria)
- Nome da categoria
- Descrição
- Slug (URL amigável, único)
- Referência à categoria pai (FK, opcional - para subcategorias)
- Ordem de exibição
- Flag de ativo
- URL da imagem

**Relacionamentos:**
- Possui vários PRODUTOS (1:N)
- Pode ter uma CATEGORIA_PAI (N:1) - auto-relacionamento
- Pode estar associada a CUPONS (N:M)

#### Entidade: PRODUTO

Representa produtos do catálogo (cafés, acessórios, kits).

**Atributos Principais:**
- Identificador único (id_produto)
- Referência à CATEGORIA (FK)
- Nome do produto
- Descrição detalhada
- Descrição curta
- Slug (URL amigável, único)
- SKU (código único)
- Preço unitário
- Preço de custo (opcional)
- Estoque atual
- Estoque mínimo
- Peso em gramas
- Dimensões (altura, largura, profundidade)
- Flag de ativo
- Flag de destaque
- Data de cadastro
- Data de atualização
- Origem do café (opcional)
- Nível de torra (opcional)
- Notas sensoriais (opcional)
- Tipo de moagem (opcional)

**Relacionamentos:**
- Pertence a uma CATEGORIA (N:1)
- Aparece em vários ITEM_PEDIDO (1:N)
- Possui várias IMAGENS_PRODUTO (1:N)
- Pode estar em vários KITS (N:M)
- Pode estar associado a LOTES_TORRA (N:M)
- Pode estar associado a CUPONS (N:M)
- Aparece em vários ITEM_CARRINHO (1:N)

#### Entidade: IMAGEM_PRODUTO

Representa imagens dos produtos.

**Atributos Principais:**
- Identificador único (id_imagem)
- Referência ao PRODUTO (FK)
- URL da imagem
- Ordem de exibição
- Flag de imagem principal
- Texto alternativo (acessibilidade)

**Relacionamentos:**
- Pertence a um PRODUTO (N:1)

#### Entidade: PEDIDO

Representa pedidos realizados pelos clientes.

**Atributos Principais:**
- Identificador único (id_pedido)
- Referência ao USUARIO/CLIENTE (FK)
- Referência ao ENDERECO_ENTREGA (FK)
- Número do pedido (único, gerado)
- Data e hora do pedido
- Status do pedido (Confirmado, Em Preparação, Enviado, Em Trânsito, Entregue, Cancelado)
- Valor subtotal
- Valor do desconto
- Valor do frete
- Valor total
- Método de pagamento (Cartão de Crédito, Pix, Boleto)
- Status do pagamento (Pendente, Aprovado, Recusado, Estornado)
- Referência ao CUPOM_DESCONTO (FK, opcional)
- Código de rastreamento
- Observações
- Data de atualização

**Relacionamentos:**
- Pertence a um USUARIO/CLIENTE (N:1)
- Usa um ENDERECO (N:1)
- Contém vários ITEM_PEDIDO (1:N)
- Pode usar um CUPOM_DESCONTO (N:1)
- Possui vários HISTORICO_STATUS_PEDIDO (1:N)
- Pode estar associado a uma ASSINATURA (1:1) - através de PEDIDO_ASSINATURA
- Pode gerar pontos em HISTORICO_PONTOS (1:N)

#### Entidade: ITEM_PEDIDO

Representa um item (produto) dentro de um pedido.

**Atributos Principais:**
- Identificador único (id_item_pedido)
- Referência ao PEDIDO (FK)
- Referência ao PRODUTO (FK)
- Quantidade
- Preço unitário no momento da compra (snapshot)
- Subtotal (quantidade × preço)

**Relacionamentos:**
- Pertence a um PEDIDO (N:1)
- Referencia um PRODUTO (N:1)

#### Entidade: HISTORICO_STATUS_PEDIDO

Representa o histórico de mudanças de status de um pedido.

**Atributos Principais:**
- Identificador único (id_historico)
- Referência ao PEDIDO (FK)
- Status anterior
- Status novo
- Data e hora da mudança
- Referência ao USUARIO que alterou (FK, opcional)
- Observações

**Relacionamentos:**
- Pertence a um PEDIDO (N:1)
- Pode ter um USUARIO (N:1)

#### Entidade: CARRINHO

Representa o carrinho de compras de um cliente.

**Atributos Principais:**
- Identificador único (id_carrinho)
- Referência ao USUARIO (FK, opcional - para carrinho persistente)
- Session ID (para carrinho não autenticado)
- Data de criação
- Data de atualização
- Data de expiração

**Relacionamentos:**
- Pertence a um USUARIO (N:1) - opcional
- Contém vários ITEM_CARRINHO (1:N)

#### Entidade: ITEM_CARRINHO

Representa um item no carrinho de compras.

**Atributos Principais:**
- Identificador único (id_item_carrinho)
- Referência ao CARRINHO (FK)
- Referência ao PRODUTO (FK)
- Quantidade
- Data de adição

**Relacionamentos:**
- Pertence a um CARRINHO (N:1)
- Referencia um PRODUTO (N:1)

#### Entidade: CUPOM_DESCONTO

Representa cupons de desconto.

**Atributos Principais:**
- Identificador único (id_cupom)
- Código do cupom (único)
- Tipo de desconto (Percentual, Valor Fixo)
- Valor do desconto
- Data de início da validade
- Data de fim da validade
- Limite de usos total (opcional)
- Limite de usos por cliente (opcional)
- Usos atuais
- Valor mínimo do pedido
- Flag de ativo
- Flag de aplicável a todos os produtos
- Data de criação

**Relacionamentos:**
- Usado em vários PEDIDOS (1:N)
- Pode ser aplicável a várias CATEGORIAS (N:M)
- Pode ser aplicável a vários PRODUTOS (N:M)

#### Entidade: PROGRAMA_FIDELIDADE

Representa o programa de pontos de fidelidade de um cliente.

**Atributos Principais:**
- Identificador único (id_fidelidade)
- Referência ao USUARIO (FK, único)
- Saldo atual de pontos
- Total de pontos ganhos (histórico)
- Total de pontos resgatados (histórico)
- Data da última atualização
- Data de cadastro

**Relacionamentos:**
- Pertence a um USUARIO (1:1)
- Possui vários HISTORICO_PONTOS (1:N)

#### Entidade: HISTORICO_PONTOS

Representa o histórico de ganhos e resgates de pontos.

**Atributos Principais:**
- Identificador único (id_historico)
- Referência ao PROGRAMA_FIDELIDADE (FK)
- Referência ao PEDIDO (FK, opcional)
- Tipo de movimentação (Ganho, Resgate, Expiracao)
- Quantidade de pontos
- Descrição
- Data e hora da movimentação

**Relacionamentos:**
- Pertence a um PROGRAMA_FIDELIDADE (N:1)
- Pode ter um PEDIDO (N:1)

#### Entidade: CONFIGURACAO_FRETE

Representa configurações de modalidades de frete.

**Atributos Principais:**
- Identificador único (id_frete)
- Nome da modalidade
- Tipo de cálculo (Por Peso, Por CEP, Tabela Fixa)
- Valor base
- Valor por kg adicional
- Prazo estimado em dias
- Flag de ativo
- Valor mínimo para frete grátis (opcional)
- Regiões atendidas (JSON)

**Relacionamentos:**
- Usado em vários PEDIDOS (1:N)

#### Entidade: PLANO_ASSINATURA

Representa planos de assinatura disponíveis.

**Atributos Principais:**
- Identificador único (id_plano)
- Nome do plano
- Descrição
- Valor mensal
- Quantidade de café incluída
- Tipo de café (opcional)
- Flag de ativo
- Benefícios (JSON)

**Relacionamentos:**
- Possui várias ASSINATURAS (1:N)

#### Entidade: ASSINATURA

Representa assinaturas do clube de café.

**Atributos Principais:**
- Identificador único (id_assinatura)
- Referência ao USUARIO (FK)
- Referência ao PLANO_ASSINATURA (FK)
- Frequência de entrega (Mensal, Trimestral, Semestral, Anual)
- Status (Ativa, Pausada, Cancelada, Expirada)
- Data de início
- Data da próxima entrega
- Data de cancelamento (opcional)
- Método de pagamento
- Valor mensal

**Relacionamentos:**
- Pertence a um USUARIO (N:1)
- Referencia um PLANO_ASSINATURA (N:1)
- Gera vários PEDIDO_ASSINATURA (1:N)

#### Entidade: PEDIDO_ASSINATURA

Representa pedidos gerados automaticamente por assinaturas.

**Atributos Principais:**
- Identificador único (id_pedido_assinatura)
- Referência à ASSINATURA (FK)
- Referência ao PEDIDO (FK)
- Data de geração
- Status (Gerado, Processado, Falhou)

**Relacionamentos:**
- Pertence a uma ASSINATURA (N:1)
- Referencia um PEDIDO (1:1)

#### Entidade: KIT

Representa kits de presente personalizáveis.

**Atributos Principais:**
- Identificador único (id_kit)
- Nome do kit
- Descrição
- Preço base (da embalagem)
- Flag de ativo

**Relacionamentos:**
- Contém vários PRODUTOS (N:M) - através de KIT_PRODUTO

#### Entidade: KIT_PRODUTO

Tabela de relacionamento entre kits e produtos.

**Atributos Principais:**
- Referência ao KIT (FK)
- Referência ao PRODUTO (FK)
- Quantidade do produto no kit
- Flag de obrigatório

**Relacionamentos:**
- Pertence a um KIT (N:1)
- Pertence a um PRODUTO (N:1)

#### Entidade: LOTE_TORRA

Representa lotes de café torrado.

**Atributos Principais:**
- Identificador único (id_lote)
- Código do lote (único)
- Tipo de grão
- Origem do grão
- Data da torra
- Peso inicial (kg)
- Peso final (kg)
- Nível de torra
- Temperatura da torra (opcional)
- Tempo de torra (opcional)
- Observações
- Referência ao USUARIO/BARISTA (FK)

**Relacionamentos:**
- Criado por um USUARIO/BARISTA (N:1)
- Pode estar associado a vários PRODUTOS (N:M) - através de LOTE_PRODUTO

#### Entidade: LOTE_PRODUTO

Tabela de relacionamento entre lotes de torra e produtos.

**Atributos Principais:**
- Referência ao LOTE_TORRA (FK)
- Referência ao PRODUTO (FK)
- Quantidade em kg

**Relacionamentos:**
- Pertence a um LOTE_TORRA (N:1)
- Pertence a um PRODUTO (N:1)

#### Entidade: ARTIGO_BLOG

Representa artigos do blog.

**Atributos Principais:**
- Identificador único (id_artigo)
- Título
- Slug (URL amigável, único)
- Conteúdo (HTML/Markdown)
- Resumo
- URL da imagem de destaque
- Autor
- Data de publicação
- Data de atualização
- Status (Rascunho, Publicado, Arquivado)
- Categoria
- Tags (JSON)
- Número de visualizações

#### Entidade: FAQ

Representa perguntas frequentes.

**Atributos Principais:**
- Identificador único (id_faq)
- Pergunta
- Resposta
- Categoria
- Ordem de exibição
- Flag de ativo
- Número de visualizações

#### Entidade: NOTIFICACAO_EMAIL

Representa histórico de e-mails enviados.

**Atributos Principais:**
- Identificador único (id_notificacao)
- Referência ao USUARIO (FK, opcional)
- Tipo de notificação
- Destinatário
- Assunto
- Corpo do e-mail
- Data e hora do envio
- Status (Enviado, Falhou, Pendente)
- Referência ao PEDIDO (FK, opcional)

**Relacionamentos:**
- Enviado para um USUARIO (N:1)
- Pode estar relacionado a um PEDIDO (N:1)

### 2..2 Relacionamentos Conceituais

**Relacionamentos Principais:**

1. **USUARIO ↔ ENDERECO**: Um usuário pode ter vários endereços (1:N)
2. **USUARIO ↔ PEDIDO**: Um usuário pode realizar vários pedidos (1:N)
3. **USUARIO ↔ PROGRAMA_FIDELIDADE**: Um usuário possui um programa de fidelidade (1:1)
4. **USUARIO ↔ CARRINHO**: Um usuário pode ter um ou mais carrinhos (1:N)
5. **CATEGORIA ↔ PRODUTO**: Uma categoria possui vários produtos (1:N)
6. **CATEGORIA ↔ CATEGORIA**: Uma categoria pode ter subcategorias (auto-relacionamento N:1)
7. **PRODUTO ↔ ITEM_PEDIDO**: Um produto pode aparecer em vários itens de pedido (1:N)
8. **PRODUTO ↔ IMAGEM_PRODUTO**: Um produto possui várias imagens (1:N)
9. **PRODUTO ↔ ITEM_CARRINHO**: Um produto pode estar em vários carrinhos (1:N)
10. **PEDIDO ↔ ITEM_PEDIDO**: Um pedido contém vários itens (1:N)
11. **PEDIDO ↔ CUPOM_DESCONTO**: Um pedido pode usar um cupom (N:1)
12. **PEDIDO ↔ HISTORICO_STATUS_PEDIDO**: Um pedido possui histórico de status (1:N)
13. **CARRINHO ↔ ITEM_CARRINHO**: Um carrinho contém vários itens (1:N)
14. **PROGRAMA_FIDELIDADE ↔ HISTORICO_PONTOS**: Um programa possui histórico de pontos (1:N)
15. **PLANO_ASSINATURA ↔ ASSINATURA**: Um plano possui várias assinaturas (1:N)
16. **ASSINATURA ↔ PEDIDO_ASSINATURA**: Uma assinatura gera vários pedidos (1:N)
17. **KIT ↔ PRODUTO**: Um kit contém vários produtos (N:M)
18. **LOTE_TORRA ↔ PRODUTO**: Um lote pode estar associado a vários produtos (N:M)
19. **CUPOM_DESCONTO ↔ CATEGORIA**: Um cupom pode ser aplicável a várias categorias (N:M)
20. **CUPOM_DESCONTO ↔ PRODUTO**: Um cupom pode ser aplicável a vários produtos (N:M)

---

## 3. Modelo Entidade-Relacionamento (ER)

O Modelo ER representa graficamente as entidades, atributos e relacionamentos do banco de dados, mostrando as cardinalidades e as chaves primárias e estrangeiras.

### 3..1 Diagrama ER Completo (Notação Textual)

```
┌─────────────────────────────────────────────────────────────────┐
│                        MODELO ER - SOTO CAFÉ                     │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐
│   USUARIO    │
├──────────────┤
│ PK id_usuario│
│    nome      │
│    email (U) │
│ senha_hash   │
│  telefone    │
│     cpf      │
│ tipo_usuario │
│    status    │
│ data_cadastro│
└──────┬───────┘
       │
       │ 1
       │
       ├──────────────────┐
       │                  │
       │ N                │ N
       │                  │
┌──────▼───────┐   ┌──────▼───────┐
│  ENDERECO    │   │   PEDIDO     │
├──────────────┤   ├──────────────┤
│PK id_endereco│   │PK id_pedido  │
│FK id_usuario │   │FK id_cliente │
│ tipo_endereco│   │FK id_endereco│
│     cep      │   │numero_pedido │
│     rua      │   │ status_pedido│
│    numero    │   │ valor_total  │
│   cidade     │   │ metodo_pag   │
│    estado    │   └──────┬───────┘
└──────────────┘          │
                          │ 1
                          │
                          │ N
                   ┌──────▼───────┐
                   │ ITEM_PEDIDO  │
                   ├──────────────┤
                   │PK id_item    │
                   │FK id_pedido  │
                   │FK id_produto │
                   │  quantidade  │
                   │   preco_unit │
                   └──────┬───────┘
                          │
                          │ N
                          │
                          │ 1
                   ┌──────▼───────┐
                   │   PRODUTO    │
                   ├──────────────┤
                   │PK id_produto │
                   │FK id_categoria│
                   │  nome_produto│
                   │     sku (U)  │
                   │ preco_unitario│
                   │estoque_atual │
                   └──────┬───────┘
                          │
                          │ N
                          │
                          │ 1
                   ┌──────▼───────┐
                   │  CATEGORIA   │
                   ├──────────────┤
                   │PK id_categoria│
                   │FK id_cat_pai │
                   │nome_categoria│
                   │  slug (U)    │
                   └──────────────┘

┌──────────────┐         ┌──────────────┐
│   USUARIO    │─────────│PROGRAMA_FIDEL│
└──────┬───────┘   1:1   └──────┬───────┘
       │                        │
       │                        │ 1
       │                        │
       │                        │ N
       │                 ┌──────▼───────┐
       │                 │HISTORICO_PONT│
       │                 ├──────────────┤
       │                 │PK id_historico│
       │                 │FK id_fidelidade│
       │                 │ tipo_moviment │
       │                 │    pontos     │
       │                 └──────────────┘

┌──────────────┐         ┌──────────────┐
│   CARRINHO   │─────────│ITEM_CARRINHO │
└──────┬───────┘   1:N   └──────┬───────┘
       │                        │
       │                        │ N
       │                        │
       │                        │ 1
       │                 ┌──────▼───────┐
       │                 │   PRODUTO    │
       │                 └──────────────┘

┌──────────────┐         ┌──────────────┐
│CUPOM_DESCONTO│─────────│   PEDIDO     │
└──────┬───────┘   N:1   └──────────────┘
       │
       │ N
       │
       │ M
┌──────▼───────┐         ┌──────────────┐
│  CATEGORIA   │         │   PRODUTO    │
└──────────────┘         └──────────────┘
       │                        │
       │                        │
       └──────── M:N ───────────┘
    (cupom_categoria)    (cupom_produto)

┌──────────────┐         ┌──────────────┐
│PLANO_ASSINAT │─────────│  ASSINATURA  │
└──────────────┘   1:N   └──────┬───────┘
                                │
                                │ 1
                                │
                                │ N
                         ┌──────▼───────┐
                         │PEDIDO_ASSINAT│
                         ├──────────────┤
                         │PK id_ped_ass │
                         │FK id_assinat │
                         │FK id_pedido  │
                         └──────────────┘

┌──────────────┐         ┌──────────────┐
│     KIT      │─────────│  KIT_PRODUTO │
└──────┬───────┘   N:M   └──────┬───────┘
       │                        │
       │                        │
       │                        │
       │                 ┌──────▼───────┐
       │                 │   PRODUTO    │
       │                 └──────────────┘

┌──────────────┐         ┌──────────────┐
│  LOTE_TORRA  │─────────│LOTE_PRODUTO  │
└──────┬───────┘   N:M   └──────┬───────┘
       │                        │
       │                        │
       │                        │
       │                 ┌──────▼───────┐
       │                 │   PRODUTO    │
       │                 └──────────────┘
```

### 3..2 Legenda do Diagrama ER

**Símbolos:**
- **PK**: Chave Primária (Primary Key)
- **FK**: Chave Estrangeira (Foreign Key)
- **U**: Único (Unique)
- **1**: Um
- **N**: Muitos
- **M**: Muitos (em relacionamento N:M)

**Cardinalidades:**
- **1:1**: Um para Um
- **1:N**: Um para Muitos
- **N:1**: Muitos para Um
- **N:M**: Muitos para Muitos

### 3..3 Tabela de Relacionamentos e Cardinalidades

| Entidade Origem | Relacionamento | Entidade Destino | Cardinalidade | Tabela de Junção |
|-----------------|----------------|------------------|---------------|------------------|
| USUARIO | possui | ENDERECO | 1:N | - |
| USUARIO | realiza | PEDIDO | 1:N | - |
| USUARIO | possui | PROGRAMA_FIDELIDADE | 1:1 | - |
| USUARIO | possui | CARRINHO | 1:N | - |
| USUARIO | cria | LOTE_TORRA | 1:N | - |
| ENDERECO | usado_em | PEDIDO | 1:N | - |
| CATEGORIA | possui | PRODUTO | 1:N | - |
| CATEGORIA | subcategoria_de | CATEGORIA | N:1 | - |
| PRODUTO | aparece_em | ITEM_PEDIDO | 1:N | - |
| PRODUTO | possui | IMAGEM_PRODUTO | 1:N | - |
| PRODUTO | aparece_em | ITEM_CARRINHO | 1:N | - |
| PEDIDO | contém | ITEM_PEDIDO | 1:N | - |
| PEDIDO | usa | CUPOM_DESCONTO | N:1 | - |
| PEDIDO | possui | HISTORICO_STATUS_PEDIDO | 1:N | - |
| CARRINHO | contém | ITEM_CARRINHO | 1:N | - |
| PROGRAMA_FIDELIDADE | possui | HISTORICO_PONTOS | 1:N | - |
| PLANO_ASSINATURA | possui | ASSINATURA | 1:N | - |
| ASSINATURA | gera | PEDIDO_ASSINATURA | 1:N | - |
| KIT | contém | PRODUTO | N:M | KIT_PRODUTO |
| LOTE_TORRA | associado_a | PRODUTO | N:M | LOTE_PRODUTO |
| CUPOM_DESCONTO | aplicável_a | CATEGORIA | N:M | CUPOM_CATEGORIA |
| CUPOM_DESCONTO | aplicável_a | PRODUTO | N:M | CUPOM_PRODUTO |

---

## 4. Projeto Físico do Banco de Dados

O Projeto Físico detalha a implementação real do banco de dados no SGBD, incluindo tipos de dados específicos, constraints, índices, triggers e outras características físicas.

### 4..1 Especificações Técnicas

**SGBD:** MySQL 8.0+ ou PostgreSQL 14+  
**Charset:** UTF-8 (utf8mb4)  
**Collation:** utf8mb4_unicode_ci  
**Engine:** InnoDB (MySQL)  
**Encoding:** UTF-8 (PostgreSQL)

### 4..2 Estrutura Física das Tabelas

#### Tabela: usuarios

**Descrição:** Armazena informações de todos os usuários do sistema.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_usuario | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| nome | VARCHAR | 255 | NO | - | NOT NULL | - |
| email | VARCHAR | 255 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| senha_hash | VARCHAR | 255 | NO | - | NOT NULL | - |
| telefone | VARCHAR | 20 | YES | NULL | - | - |
| cpf | VARCHAR | 14 | YES | NULL | - | - |
| tipo_usuario | ENUM | - | NO | 'Cliente' | NOT NULL | INDEX |
| status | ENUM | - | NO | 'Ativo' | NOT NULL | INDEX |
| data_cadastro | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |
| data_ultimo_acesso | TIMESTAMP | - | YES | NULL | - | - |
| email_verificado | BOOLEAN | - | NO | FALSE | NOT NULL | - |
| token_ativacao | VARCHAR | 255 | YES | NULL | - | - |
| data_expiracao_token | TIMESTAMP | - | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_usuario)
- UNIQUE KEY (email)
- INDEX (tipo_usuario)
- INDEX (status)

**Foreign Keys:** Nenhuma

---

#### Tabela: enderecos

**Descrição:** Armazena endereços de entrega e cobrança dos usuários.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_endereco | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_usuario | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| tipo_endereco | ENUM | - | NO | 'Residencial' | NOT NULL | - |
| cep | VARCHAR | 10 | NO | - | NOT NULL | INDEX |
| rua | VARCHAR | 255 | NO | - | NOT NULL | - |
| numero | VARCHAR | 20 | NO | - | NOT NULL | - |
| complemento | VARCHAR | 100 | YES | NULL | - | - |
| bairro | VARCHAR | 100 | NO | - | NOT NULL | - |
| cidade | VARCHAR | 100 | NO | - | NOT NULL | - |
| estado | VARCHAR | 2 | NO | - | NOT NULL | - |
| ponto_referencia | VARCHAR | 255 | YES | NULL | - | - |
| endereco_principal | BOOLEAN | - | NO | FALSE | NOT NULL | - |
| data_cadastro | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_endereco)
- INDEX (id_usuario)
- INDEX (cep)

**Foreign Keys:**
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE

---

#### Tabela: categorias

**Descrição:** Armazena categorias e subcategorias de produtos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_categoria | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| nome_categoria | VARCHAR | 100 | NO | - | NOT NULL | - |
| descricao | TEXT | - | YES | NULL | - | - |
| slug | VARCHAR | 100 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| id_categoria_pai | BIGINT | - | YES | NULL | FK | - |
| ordem_exibicao | INT | - | NO | 0 | NOT NULL | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| imagem | VARCHAR | 255 | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_categoria)
- UNIQUE KEY (slug)
- INDEX (ativo)

**Foreign Keys:**
- FOREIGN KEY (id_categoria_pai) REFERENCES categorias(id_categoria) ON DELETE SET NULL

---

#### Tabela: produtos

**Descrição:** Armazena informações dos produtos do catálogo.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_produto | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_categoria | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| nome_produto | VARCHAR | 255 | NO | - | NOT NULL | - |
| descricao | TEXT | - | YES | NULL | - | - |
| descricao_curta | VARCHAR | 500 | YES | NULL | - | - |
| slug | VARCHAR | 255 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| sku | VARCHAR | 100 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| preco_unitario | DECIMAL | 10,2 | NO | - | NOT NULL, CHECK > 0 | - |
| preco_custo | DECIMAL | 10,2 | YES | NULL | - | - |
| estoque_atual | INT | - | NO | 0 | NOT NULL, CHECK >= 0 | - |
| estoque_minimo | INT | - | NO | 0 | NOT NULL | - |
| peso_gramas | DECIMAL | 10,2 | NO | - | NOT NULL | - |
| altura_cm | DECIMAL | 10,2 | YES | NULL | - | - |
| largura_cm | DECIMAL | 10,2 | YES | NULL | - | - |
| profundidade_cm | DECIMAL | 10,2 | YES | NULL | - | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| destaque | BOOLEAN | - | NO | FALSE | NOT NULL | INDEX |
| data_cadastro | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |
| data_atualizacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE | NOT NULL | - |
| origem | VARCHAR | 100 | YES | NULL | - | - |
| nivel_torra | VARCHAR | 50 | YES | NULL | - | - |
| notas_sensoriais | TEXT | - | YES | NULL | - | - |
| tipo_moagem | VARCHAR | 50 | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_produto)
- INDEX (id_categoria)
- UNIQUE KEY (sku)
- UNIQUE KEY (slug)
- INDEX (ativo)
- INDEX (destaque)

**Foreign Keys:**
- FOREIGN KEY (id_categoria) REFERENCES categorias(id_categoria) ON DELETE RESTRICT

**Constraints:**
- CHECK (preco_unitario > 0)
- CHECK (estoque_atual >= 0)

---

#### Tabela: imagens_produto

**Descrição:** Armazena URLs das imagens dos produtos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_imagem | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| url_imagem | VARCHAR | 500 | NO | - | NOT NULL | - |
| ordem | INT | - | NO | 0 | NOT NULL | - |
| principal | BOOLEAN | - | NO | FALSE | NOT NULL | - |
| alt_text | VARCHAR | 255 | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_imagem)
- INDEX (id_produto)

**Foreign Keys:**
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE CASCADE

---

#### Tabela: carrinho

**Descrição:** Armazena carrinhos de compras (persistentes ou por sessão).

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_carrinho | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_usuario | BIGINT | - | YES | NULL | FK | INDEX |
| session_id | VARCHAR | 255 | YES | NULL | - | INDEX |
| data_criacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |
| data_atualizacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE | NOT NULL | - |
| data_expiracao | TIMESTAMP | - | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_carrinho)
- INDEX (id_usuario)
- INDEX (session_id)

**Foreign Keys:**
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE

---

#### Tabela: item_carrinho

**Descrição:** Armazena itens adicionados ao carrinho.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_item_carrinho | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_carrinho | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK | - |
| quantidade | INT | - | NO | - | NOT NULL, CHECK > 0 | - |
| data_adicao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_item_carrinho)
- INDEX (id_carrinho)

**Foreign Keys:**
- FOREIGN KEY (id_carrinho) REFERENCES carrinho(id_carrinho) ON DELETE CASCADE
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE CASCADE

**Constraints:**
- CHECK (quantidade > 0)

---

#### Tabela: cupons_desconto

**Descrição:** Armazena cupons de desconto.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_cupom | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| codigo_cupom | VARCHAR | 50 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| tipo_desconto | ENUM | - | NO | - | NOT NULL | - |
| valor_desconto | DECIMAL | 10,2 | NO | - | NOT NULL, CHECK > 0 | - |
| data_inicio | DATE | - | NO | - | NOT NULL | - |
| data_fim | DATE | - | NO | - | NOT NULL | - |
| limite_usos_total | INT | - | YES | NULL | - | - |
| limite_usos_por_cliente | INT | - | YES | NULL | - |
| usos_atuais | INT | - | NO | 0 | NOT NULL | - |
| valor_minimo_pedido | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| aplicavel_todos_produtos | BOOLEAN | - | NO | TRUE | NOT NULL | - |
| data_criacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_cupom)
- UNIQUE KEY (codigo_cupom)
- INDEX (ativo)

**Foreign Keys:** Nenhuma

**Constraints:**
- CHECK (valor_desconto > 0)
- CHECK (data_fim >= data_inicio)

---

#### Tabela: cupom_categoria

**Descrição:** Tabela de relacionamento N:M entre cupons e categorias.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_cupom | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| id_categoria | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |

**Índices:**
- PRIMARY KEY (id_cupom, id_categoria)

**Foreign Keys:**
- FOREIGN KEY (id_cupom) REFERENCES cupons_desconto(id_cupom) ON DELETE CASCADE
- FOREIGN KEY (id_categoria) REFERENCES categorias(id_categoria) ON DELETE CASCADE

---

#### Tabela: cupom_produto

**Descrição:** Tabela de relacionamento N:M entre cupons e produtos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_cupom | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |

**Índices:**
- PRIMARY KEY (id_cupom, id_produto)

**Foreign Keys:**
- FOREIGN KEY (id_cupom) REFERENCES cupons_desconto(id_cupom) ON DELETE CASCADE
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE CASCADE

---

#### Tabela: pedidos

**Descrição:** Armazena pedidos realizados pelos clientes.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_pedido | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_cliente | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_endereco_entrega | BIGINT | - | NO | - | NOT NULL, FK | - |
| numero_pedido | VARCHAR | 50 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| data_pedido | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | INDEX |
| status_pedido | ENUM | - | NO | 'Confirmado' | NOT NULL | INDEX |
| valor_subtotal | DECIMAL | 10,2 | NO | - | NOT NULL | - |
| valor_desconto | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| valor_frete | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| valor_total | DECIMAL | 10,2 | NO | - | NOT NULL, CHECK > 0 | - |
| metodo_pagamento | ENUM | - | NO | - | NOT NULL | - |
| status_pagamento | ENUM | - | NO | 'Pendente' | NOT NULL | - |
| id_cupom | BIGINT | - | YES | NULL | FK | - |
| codigo_rastreamento | VARCHAR | 100 | YES | NULL | - | - |
| observacoes | TEXT | - | YES | NULL | - | - |
| data_atualizacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_pedido)
- INDEX (id_cliente)
- UNIQUE KEY (numero_pedido)
- INDEX (status_pedido)
- INDEX (data_pedido)

**Foreign Keys:**
- FOREIGN KEY (id_cliente) REFERENCES usuarios(id_usuario) ON DELETE RESTRICT
- FOREIGN KEY (id_endereco_entrega) REFERENCES enderecos(id_endereco) ON DELETE RESTRICT
- FOREIGN KEY (id_cupom) REFERENCES cupons_desconto(id_cupom) ON DELETE SET NULL

**Constraints:**
- CHECK (valor_total > 0)

---

#### Tabela: item_pedido

**Descrição:** Armazena itens (produtos) de cada pedido.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_item_pedido | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_pedido | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK | - |
| quantidade | INT | - | NO | - | NOT NULL, CHECK > 0 | - |
| preco_unitario_no_pedido | DECIMAL | 10,2 | NO | - | NOT NULL, CHECK > 0 | - |
| subtotal | DECIMAL | 10,2 | NO | - | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_item_pedido)
- INDEX (id_pedido)

**Foreign Keys:**
- FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido) ON DELETE CASCADE
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE RESTRICT

**Constraints:**
- CHECK (quantidade > 0)
- CHECK (preco_unitario_no_pedido > 0)

---

#### Tabela: historico_status_pedido

**Descrição:** Armazena histórico de mudanças de status dos pedidos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_historico | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_pedido | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| status_anterior | VARCHAR | 50 | YES | NULL | - | - |
| status_novo | VARCHAR | 50 | NO | - | NOT NULL | - |
| data_mudanca | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | INDEX |
| id_usuario | BIGINT | - | YES | NULL | FK | - |
| observacoes | TEXT | - | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_historico)
- INDEX (id_pedido)
- INDEX (data_mudanca)

**Foreign Keys:**
- FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido) ON DELETE CASCADE
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE SET NULL

---

#### Tabela: programa_fidelidade

**Descrição:** Armazena informações do programa de fidelidade dos clientes.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_fidelidade | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_usuario | BIGINT | - | NO | - | NOT NULL, FK, UNIQUE | UNIQUE |
| saldo_pontos | INT | - | NO | 0 | NOT NULL | - |
| pontos_totais_ganhos | INT | - | NO | 0 | NOT NULL | - |
| pontos_totais_resgatados | INT | - | NO | 0 | NOT NULL | - |
| data_ultima_atualizacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE | NOT NULL | - |
| data_cadastro | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_fidelidade)
- UNIQUE KEY (id_usuario)

**Foreign Keys:**
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE

---

#### Tabela: historico_pontos

**Descrição:** Armazena histórico de movimentações de pontos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_historico | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_fidelidade | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_pedido | BIGINT | - | YES | NULL | FK | - |
| tipo_movimentacao | ENUM | - | NO | - | NOT NULL | - |
| pontos | INT | - | NO | - | NOT NULL | - |
| descricao | VARCHAR | 255 | YES | NULL | - | - |
| data_movimentacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | INDEX |

**Índices:**
- PRIMARY KEY (id_historico)
- INDEX (id_fidelidade)
- INDEX (data_movimentacao)

**Foreign Keys:**
- FOREIGN KEY (id_fidelidade) REFERENCES programa_fidelidade(id_fidelidade) ON DELETE CASCADE
- FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido) ON DELETE SET NULL

---

#### Tabela: configuracoes_frete

**Descrição:** Armazena configurações de modalidades de frete.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_frete | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| nome_modalidade | VARCHAR | 100 | NO | - | NOT NULL | - |
| tipo_calculo | ENUM | - | NO | - | NOT NULL | - |
| valor_base | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| valor_por_kg | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| prazo_dias | INT | - | NO | 0 | NOT NULL | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| frete_gratis_acima | DECIMAL | 10,2 | YES | NULL | - | - |
| regioes_atendidas | JSON | - | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_frete)
- INDEX (ativo)

**Foreign Keys:** Nenhuma

---

#### Tabela: planos_assinatura

**Descrição:** Armazena planos de assinatura disponíveis.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_plano | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| nome_plano | VARCHAR | 100 | NO | - | NOT NULL | - |
| descricao | TEXT | - | YES | NULL | - | - |
| valor_mensal | DECIMAL | 10,2 | NO | - | NOT NULL | - |
| quantidade_cafe | INT | - | YES | NULL | - | - |
| tipo_cafe | VARCHAR | 100 | YES | NULL | - | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| beneficios | JSON | - | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_plano)
- INDEX (ativo)

**Foreign Keys:** Nenhuma

---

#### Tabela: assinaturas

**Descrição:** Armazena assinaturas ativas dos clientes.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_assinatura | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_usuario | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_plano | BIGINT | - | NO | - | NOT NULL, FK | - |
| frequencia_entrega | ENUM | - | NO | 'Mensal' | NOT NULL | - |
| status | ENUM | - | NO | 'Ativa' | NOT NULL | INDEX |
| data_inicio | DATE | - | NO | - | NOT NULL | - |
| data_proxima_entrega | DATE | - | YES | NULL | - | - |
| data_cancelamento | DATE | - | YES | NULL | - | - |
| metodo_pagamento | VARCHAR | 50 | YES | NULL | - | - |
| valor_mensal | DECIMAL | 10,2 | NO | - | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_assinatura)
- INDEX (id_usuario)
- INDEX (status)

**Foreign Keys:**
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE
- FOREIGN KEY (id_plano) REFERENCES planos_assinatura(id_plano) ON DELETE RESTRICT

---

#### Tabela: pedidos_assinatura

**Descrição:** Armazena relação entre assinaturas e pedidos gerados.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_pedido_assinatura | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_assinatura | BIGINT | - | NO | - | NOT NULL, FK | INDEX |
| id_pedido | BIGINT | - | NO | - | NOT NULL, FK | - |
| data_geracao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |
| status | ENUM | - | NO | 'Gerado' | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_pedido_assinatura)
- INDEX (id_assinatura)

**Foreign Keys:**
- FOREIGN KEY (id_assinatura) REFERENCES assinaturas(id_assinatura) ON DELETE CASCADE
- FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido) ON DELETE CASCADE

---

#### Tabela: kits

**Descrição:** Armazena kits de presente personalizáveis.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_kit | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| nome_kit | VARCHAR | 255 | NO | - | NOT NULL | - |
| descricao | TEXT | - | YES | NULL | - | - |
| preco_base | DECIMAL | 10,2 | NO | 0 | NOT NULL | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_kit)

**Foreign Keys:** Nenhuma

---

#### Tabela: kit_produto

**Descrição:** Tabela de relacionamento N:M entre kits e produtos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_kit | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| quantidade | INT | - | NO | 1 | NOT NULL | - |
| obrigatorio | BOOLEAN | - | NO | FALSE | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_kit, id_produto)

**Foreign Keys:**
- FOREIGN KEY (id_kit) REFERENCES kits(id_kit) ON DELETE CASCADE
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE CASCADE

---

#### Tabela: lotes_torra

**Descrição:** Armazena informações de lotes de café torrado.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_lote | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| codigo_lote | VARCHAR | 50 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| tipo_grao | VARCHAR | 100 | YES | NULL | - | - |
| origem | VARCHAR | 100 | YES | NULL | - | - |
| data_torra | DATE | - | NO | - | NOT NULL | INDEX |
| peso_inicial_kg | DECIMAL | 10,2 | YES | NULL | - | - |
| peso_final_kg | DECIMAL | 10,2 | YES | NULL | - | - |
| nivel_torra | VARCHAR | 50 | YES | NULL | - | - |
| temperatura_torra | DECIMAL | 5,2 | YES | NULL | - | - |
| tempo_torra | INT | - | YES | NULL | - | - |
| observacoes | TEXT | - | YES | NULL | - | - |
| id_barista | BIGINT | - | YES | NULL | FK | - |

**Índices:**
- PRIMARY KEY (id_lote)
- UNIQUE KEY (codigo_lote)
- INDEX (data_torra)

**Foreign Keys:**
- FOREIGN KEY (id_barista) REFERENCES usuarios(id_usuario) ON DELETE SET NULL

---

#### Tabela: lote_produto

**Descrição:** Tabela de relacionamento N:M entre lotes de torra e produtos.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_lote | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| id_produto | BIGINT | - | NO | - | NOT NULL, FK, PK | PK |
| quantidade_kg | DECIMAL | 10,2 | YES | NULL | - | - |

**Índices:**
- PRIMARY KEY (id_lote, id_produto)

**Foreign Keys:**
- FOREIGN KEY (id_lote) REFERENCES lotes_torra(id_lote) ON DELETE CASCADE
- FOREIGN KEY (id_produto) REFERENCES produtos(id_produto) ON DELETE CASCADE

---

#### Tabela: artigos_blog

**Descrição:** Armazena artigos do blog.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_artigo | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| titulo | VARCHAR | 255 | NO | - | NOT NULL | - |
| slug | VARCHAR | 255 | NO | - | NOT NULL, UNIQUE | UNIQUE |
| conteudo | TEXT | - | NO | - | NOT NULL | - |
| resumo | VARCHAR | 500 | YES | NULL | - | - |
| imagem_destaque | VARCHAR | 500 | YES | NULL | - | - |
| autor | VARCHAR | 100 | YES | NULL | - | - |
| data_publicacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | INDEX |
| data_atualizacao | TIMESTAMP | - | NO | CURRENT_TIMESTAMP ON UPDATE | NOT NULL | - |
| status | ENUM | - | NO | 'Rascunho' | NOT NULL | INDEX |
| categoria | VARCHAR | 100 | YES | NULL | - | - |
| tags | JSON | - | YES | NULL | - | - |
| visualizacoes | INT | - | NO | 0 | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_artigo)
- UNIQUE KEY (slug)
- INDEX (status)
- INDEX (data_publicacao)

**Foreign Keys:** Nenhuma

---

#### Tabela: faq

**Descrição:** Armazena perguntas frequentes.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_faq | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| pergunta | VARCHAR | 500 | NO | - | NOT NULL | - |
| resposta | TEXT | - | NO | - | NOT NULL | - |
| categoria | VARCHAR | 100 | YES | NULL | INDEX | - |
| ordem | INT | - | NO | 0 | NOT NULL | - |
| ativo | BOOLEAN | - | NO | TRUE | NOT NULL | INDEX |
| visualizacoes | INT | - | NO | 0 | NOT NULL | - |

**Índices:**
- PRIMARY KEY (id_faq)
- INDEX (categoria)
- INDEX (ativo)

**Foreign Keys:** Nenhuma

---

#### Tabela: notificacoes_email

**Descrição:** Armazena histórico de e-mails enviados.

| Coluna | Tipo | Tamanho | Null | Default | Constraints | Índices |
|--------|------|---------|------|---------|-------------|---------|
| id_notificacao | BIGINT | - | NO | AUTO_INCREMENT | PRIMARY KEY | PK |
| id_usuario | BIGINT | - | YES | NULL | FK | INDEX |
| tipo | VARCHAR | 50 | NO | - | NOT NULL | INDEX |
| destinatario | VARCHAR | 255 | NO | - | NOT NULL | - |
| assunto | VARCHAR | 255 | NO | - | NOT NULL | - |
| corpo | TEXT | - | NO | - | NOT NULL | - |
| data_envio | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | NOT NULL | - |
| status | ENUM | - | NO | 'Pendente' | NOT NULL | INDEX |
| id_pedido | BIGINT | - | YES | NULL | FK | - |

**Índices:**
- PRIMARY KEY (id_notificacao)
- INDEX (id_usuario)
- INDEX (tipo)
- INDEX (status)

**Foreign Keys:**
- FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE SET NULL
- FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido) ON DELETE SET NULL

---

### 4..3 Índices e Otimizações

**Índices Primários:**
- Todas as tabelas possuem chave primária auto-incremental (BIGINT)

**Índices Únicos:**
- usuarios.email
- produtos.sku
- produtos.slug
- categorias.slug
- cupons_desconto.codigo_cupom
- pedidos.numero_pedido
- lotes_torra.codigo_lote
- artigos_blog.slug
- programa_fidelidade.id_usuario

**Índices de Performance:**
- usuarios.tipo_usuario
- usuarios.status
- enderecos.id_usuario
- enderecos.cep
- produtos.id_categoria
- produtos.ativo
- produtos.destaque
- pedidos.id_cliente
- pedidos.status_pedido
- pedidos.data_pedido
- item_pedido.id_pedido
- carrinho.id_usuario
- carrinho.session_id
- historico_status_pedido.id_pedido
- historico_status_pedido.data_mudanca
- historico_pontos.id_fidelidade
- historico_pontos.data_movimentacao
- assinaturas.id_usuario
- assinaturas.status
- pedidos_assinatura.id_assinatura
- lotes_torra.data_torra
- artigos_blog.status
- artigos_blog.data_publicacao
- faq.categoria
- faq.ativo
- notificacoes_email.id_usuario
- notificacoes_email.tipo
- notificacoes_email.status

### 4..4 Constraints e Validações

**Check Constraints:**
- produtos.preco_unitario > 0
- produtos.estoque_atual >= 0
- item_carrinho.quantidade > 0
- item_pedido.quantidade > 0
- item_pedido.preco_unitario_no_pedido > 0
- pedidos.valor_total > 0
- cupons_desconto.valor_desconto > 0
- cupons_desconto.data_fim >= data_inicio

**Foreign Key Constraints:**
- Todas as chaves estrangeiras possuem ações de integridade referencial:
  - ON DELETE CASCADE: Para relacionamentos onde a exclusão do pai deve excluir os filhos
  - ON DELETE RESTRICT: Para relacionamentos críticos onde não se pode excluir o pai
  - ON DELETE SET NULL: Para relacionamentos opcionais

### 4..5 Triggers Recomendados

**Trigger 1: Atualização Automática de Estoque**
- Ao criar um pedido, reduzir estoque dos produtos
- Ao cancelar um pedido, reverter estoque

**Trigger 2: Geração Automática de Número de Pedido**
- Gerar número único sequencial ao criar pedido

**Trigger 3: Atualização de Histórico de Status**
- Registrar automaticamente mudanças de status de pedido

**Trigger 4: Acúmulo Automático de Pontos**
- Ao confirmar pagamento de pedido, adicionar pontos ao programa de fidelidade

**Trigger 5: Limpeza de Carrinhos Expirados**
- Remover carrinhos expirados periodicamente

### 4..6 Views Recomendadas

**View 1: vw_pedidos_completo**
- Junta pedidos com itens, produtos, cliente e endereço

**View 2: vw_produtos_estoque_baixo**
- Lista produtos com estoque abaixo do mínimo

**View 3: vw_vendas_por_periodo**
- Agrega vendas por período (dia, semana, mês)

**View 4: vw_clientes_fidelidade**
- Lista clientes com saldo de pontos e histórico

**View 5: vw_produtos_mais_vendidos**
- Ranking de produtos mais vendidos

### 4..7 Stored Procedures Recomendadas

**Procedure 1: sp_calcular_frete**
- Calcula frete baseado em peso, dimensões e CEP

**Procedure 2: sp_processar_pedido**
- Processa criação de pedido, valida estoque, aplica desconto

**Procedure 3: sp_atualizar_estoque**
- Atualiza estoque de forma segura (com lock)

**Procedure 4: sp_gerar_relatorio_vendas**
- Gera relatório de vendas com filtros

**Procedure 5: sp_processar_assinatura**
- Processa geração de pedido para assinatura

### 4..8 Considerações de Performance

**Particionamento:**
- Considerar particionamento por data para tabelas grandes:
  - pedidos (por data_pedido)
  - historico_status_pedido (por data_mudanca)
  - historico_pontos (por data_movimentacao)
  - notificacoes_email (por data_envio)

**Cache:**
- Cachear consultas frequentes:
  - Lista de categorias ativas
  - Produtos em destaque
  - Configurações de frete

**Arquivo de Log:**
- Configurar log binário para replicação (futuro)
- Configurar log de transações para recovery

### 4..9 Backup e Recuperação

**Estratégia de Backup:**
- Backup completo diário
- Backup incremental a cada 6 horas
- Backup de transações a cada hora
- Retenção de 30 dias

**Teste de Recuperação:**
- Testar restauração mensalmente
- Documentar procedimentos de recuperação

---

## 5. Mapeamento Diagrama de Classes → Modelo de Dados

### 5..1 Correspondência de Classes para Tabelas

| Classe (Diagrama de Classes) | Tabela (Banco de Dados) |
|------------------------------|-------------------------|
| Usuario | usuarios |
| Endereco | enderecos |
| Categoria | categorias |
| Produto | produtos |
| ImagemProduto | imagens_produto |
| Pedido | pedidos |
| ItemPedido | item_pedido |
| HistoricoStatusPedido | historico_status_pedido |
| Carrinho | carrinho |
| ItemCarrinho | item_carrinho |
| CupomDesconto | cupons_desconto |
| ProgramaFidelidade | programa_fidelidade |
| HistoricoPontos | historico_pontos |
| ConfiguracaoFrete | configuracoes_frete |
| Assinatura | assinaturas |
| PlanoAssinatura | planos_assinatura |
| PedidoAssinatura | pedidos_assinatura |
| Kit | kits |
| LoteTorra | lotes_torra |
| ArtigoBlog | artigos_blog |
| FAQ | faq |
| NotificacaoEmail | notificacoes_email |

### 5..2 Tabelas de Relacionamento N:M

| Relacionamento | Tabela de Junção |
|----------------|------------------|
| Kit ↔ Produto | kit_produto |
| LoteTorra ↔ Produto | lote_produto |
| CupomDesconto ↔ Categoria | cupom_categoria |
| CupomDesconto ↔ Produto | cupom_produto |

---

## 6. Considerações Finais

O Modelo Conceitual, Modelo ER e Projeto Físico foram desenvolvidos a partir do Diagrama de Classes, garantindo consistência entre a modelagem orientada a objetos e a modelagem relacional. O banco de dados foi projetado para suportar todas as funcionalidades do sistema, com foco em performance, integridade de dados e escalabilidade.

**Próximos Passos:**
- Implementar triggers e stored procedures
- Criar scripts de migração
- Configurar backup automático
- Otimizar índices baseado em uso real
- Implementar particionamento se necessário


